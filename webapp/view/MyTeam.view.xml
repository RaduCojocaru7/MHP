<mvc:View
  controllerName="fbtool.controller.MyTeam"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core"
  displayBlock="true">

  <Page title="My Team">
    <headerContent>
      <Button icon="sap-icon://nav-back" text="Back" press="onBack" type="Transparent"/>
    </headerContent>

    <content>
      <VBox class="sapUiMediumMargin">

        <!-- ===================== Lista echipÄƒ (manager) ===================== -->
        <Panel headerText="My Team">
          <Table id="teamTable"
                 width="100%"
                 mode="None"
                 items="{ path: 'mainService>/UserSet' }">
            <columns>
              <Column>
                <Text text="Name"/>
              </Column>
            </columns>
            <items>
              <ColumnListItem type="Inactive">
                <cells>
                  <Text text="{mainService>NAME}"/>
                </cells>
              </ColumnListItem>
            </items>
          </Table>
        </Panel>

        <!-- ===================== PM Feedback Requests ===================== -->
        <Panel headerText="PM Feedback Requests" class="sapUiMediumMarginTop">
          <VBox class="sapUiSmallMargin">

            <HBox alignItems="Center" class="sapUiTinyMarginBottom">
              <Label text="Mode" class="sapUiTinyMarginEnd"/>
              <Select id="pmModeSelect" width="12rem" selectedKey="sent" change=".onPmModeChange">
                <core:Item key="sent"     text="Sent"/>
                <core:Item key="received" text="Received"/>
              </Select>
            </HBox>

            <Table id="pmReqTable"
                   class="tightTable sapUiSizeCompact"
                   width="100%"
                   mode="None"
                   items="{ 
                     path: 'mainService>/Manager_Feedback_RequestSet',
                     parameters: { 
                       $select: 'FB_REQ_ID,FB_REQ_NR,FROM_MNGR_ID,TO_MNGR_ID,TEAM_MBR_ID,SEND_DATE,INPUT_TEXT,PROJ_ID,STATUS' 
                     }
                   }">
              <columns>
                <Column width="9rem"><Text text="Request Date"/></Column>
                <Column width="7rem"><Text text="Status"/></Column>
                <Column width="9rem"><Text text="Request nr."/></Column>
                <Column width="14rem"><Text text="From team manager"/></Column>
                <Column width="16rem"><Text text="To project manager"/></Column>
                <Column width="16rem"><Text text="Team member name"/></Column>
                <Column width="20rem"><Text text="Message"/></Column>
                <Column width="10rem"><Text text="Project"/></Column>
              </columns>

              <items>
                <ColumnListItem type="Inactive" vAlign="Middle">
                  <cells>
                    <!-- Request Date -->
                    <Text text="{ path: 'mainService>SEND_DATE', formatter: '.fmtDateShort' }" wrapping="false"/>
                    
                    <!-- Status -->
                    <ObjectStatus text="{mainService>STATUS}"
                                  state="{= ${mainService>STATUS} === 'DONE' ? 'Success' :
                                           ${mainService>STATUS} === 'PENDING' ? 'Warning' : 'None' }"/>
                    
                    <!-- Request nr -->
                    <Text text="{mainService>FB_REQ_NR}" wrapping="false"/>

                    <!-- From team manager - nume din ID folosind mapa din modelul 'lkp' -->
                    <Text wrapping="false"
                      text="{
                        parts: [
                          {path: 'mainService>FROM_MNGR_ID'},
                          {path: 'lkp>/userById'}
                        ],
                        formatter: '.fmtUserNameMap'
                      }"/>

                    <!-- To project manager -->
                    <Text wrapping="false"
                      text="{
                        parts: [
                          {path: 'mainService>TO_MNGR_ID'},
                          {path: 'lkp>/userById'}
                        ],
                        formatter: '.fmtUserNameMap'
                      }"/>

                    <!-- Team member name -->
                    <Text wrapping="false"
                      text="{
                        parts: [
                          {path: 'mainService>TEAM_MBR_ID'},
                          {path: 'lkp>/userById'}
                        ],
                        formatter: '.fmtUserNameMap'
                      }"/>

                    <!-- Message - Mesajul din feedback request -->
                    <Text text="{mainService>INPUT_TEXT}" 
                          wrapping="true" 
                          maxLines="3"
                          class="sapUiTinyMargin"/>

                    <!-- Project -->
                    <Text wrapping="false"
                      text="{
                        parts: [
                          {path: 'mainService>PROJ_ID'},
                          {path: 'lkp>/projById'}
                        ],
                        formatter: '.fmtProjFromMap'
                      }"/>

                  </cells>
                </ColumnListItem>
              </items>
            </Table>

          </VBox>
        </Panel>

      </VBox>
    </content>
  </Page>
</mvc:View>